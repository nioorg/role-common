nioorg-common role
=========

[![Build Status](https://github.com/nioorg/role-common/actions/workflows/build.yml/badge.svg?branch=master)](https://github.com/nioorg/role-common/actions/workflows/build.yml)

Common Ansible role that executes all the tasks to run, setup and initialize a system. It will perform the following actions:

* Perform the first login and setup the main administration account (only the first time)
* Add any additional administrator account
* Add any additional user account
* Hardening: disable root account
* Hardening: disable password authentication
* Update the repository list
* Upgrade the packages
* Setup the hostname and FQDN
* Set the timezone
* Enable the firewall and ensure ssh traffic is allowed 

Requirements
------------

To execute this role you need the following packages:

* pexpect
* bcrypt
* stormssh

Role Variables
--------------

Fundamental role parameters.

| Variable                  | Required | Default     | Choices                        | Comments                                 |
|---------------------------|----------|-------------|--------------------------------|------------------------------------------|
| timezone                  | no       | Europe/Rome | String: timezone database name | Any timezone supported by the linux systems. [Reference](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones) |
| admin_accounts            | no       | []          | Array of `accounts`            | See the following section for details on the object definition |
| user_accounts             | no       | []          | Array of `accounts`            | See the following section for details on the object definition |
| firewall.ipv6             | no       | no          | no, yes                        | Flag indicating if ufw should configure the IPv6 table         |
| firewall.default_incoming | no       | deny        | allow, limit, deny, reject     | The default rule for incoming traffic    |
| firewall.default_outgoing | no       | allow       | allow, limit, deny, reject     | The default rule for outgoing traffic    |

Variables for each account object.

| Variable                  | Required | Default                              | Choices                 | Comments                          |
|---------------------------|----------|--------------------------------------|-------------------------|-----------------------------------|
| username                  | yes      |                                      |                         | Username of the account to create |
| password                  | no       | Autogenerated in `~/secrets/$HOSTNAME/$USERNAME/password.txt` |  | Password of the account to create |
| ssh.keyfile               | no       | Autogenerated in `~/secrets/$HOSTNAME/$USERNAME/rsa`    |                         | The path to the keyfile on the host running the ansible job were it is located or will be created during the account setup |
| ssh.passphrase            | no       | None                                 |                         | By default the keyfile is generated without specifying any passphrase |

Dependencies
------------

This role doesn't have any dependency

Example Playbook
----------------

Here is an example playbook using the default variables:

    - hosts: all
      roles:
          - common

License
-------

See LICENSE

Author Information
------------------

https://github.com/iuginP/
